# 백테스트 실행 가이드

이 문서는 복슬퀀트 프로젝트의 백테스트 실행 방법을 설명합니다.

## 개요

복슬퀀트는 **테스트 코드 방식**을 사용하여 백테스트를 실행합니다. 이 방식은 대화형 입력보다 효율적이며, 반복 실행과 설정 관리가 용이합니다.

## 현재 지원되는 백테스트

### 1. 일시투자 vs 적립투자 (Lump Sum vs DCA)

동일한 투자금으로 일시투자와 적립투자 전략의 성과를 비교 분석합니다.

**위치**: `backtests/lump_sum_vs_dca/`

## 실행 방법

### 단계별 실행 가이드

#### 1. 백테스트 디렉토리로 이동
```bash
cd backtests/lump_sum_vs_dca
```

#### 2. 설정 변수 수정
`run_backtest.py` 파일의 `BACKTEST_CONFIG` 변수를 수정합니다:

```python
BACKTEST_CONFIG = {
    'symbol': 'NASDAQ',                    # 투자 지수
    'start_year': 2020,                    # 투자 시작 연도
    'start_month': 1,                      # 투자 시작 월 (1-12)
    'investment_period_years': 3,          # 투자 기간 (년)
    'dca_months': 24,                      # 적립 분할 월수
}
```

#### 3. 백테스트 실행
```bash
python run_backtest.py
```

## 설정 변수 상세 설명

### BACKTEST_CONFIG 파라미터

| 변수명                    | 타입   | 설명           | 예시                       | 제약사항                          |
| ------------------------- | ------ | -------------- | -------------------------- | --------------------------------- |
| `symbol`                  | string | 투자할 지수명  | 'NASDAQ', 'SP500', 'KOSPI' | data 폴더에 해당 데이터 파일 필요 |
| `start_year`              | int    | 투자 시작 연도 | 2020                       | 데이터 범위 내                    |
| `start_month`             | int    | 투자 시작 월   | 1                          | 1-12                              |
| `investment_period_years` | int    | 투자 기간 (년) | 3                          | 1 이상                            |
| `dca_months`              | int    | 적립 분할 월수 | 24                         | 1 이상, 투자기간 내               |

### 고정 설정값

- **총 투자금**: 10,000,000원 (1천만원) - 고정값
- **월 적립금**: 총 투자금 ÷ 적립 분할 월수로 자동 계산

## 사용 가능한 지수

현재 프로젝트에서 지원하는 지수 목록:

- **NASDAQ**: 나스닥 종합지수
- **SP500**: S&P 500 지수
- **KOSPI**: 한국 종합주가지수
- **KOSDAQ**: 한국 코스닥 지수
- **DOW**: 다우존스 산업평균지수
- **FTSE**: FTSE 100 지수
- **DAX**: 독일 DAX 지수
- **CAC**: 프랑스 CAC 40 지수
- **NIKKEI**: 일본 닛케이 225 지수
- **HSI**: 홍콩 항셍지수

## 실행 예시

### 예시 1: 나스닥 3년 투자 (24개월 분할)
```python
BACKTEST_CONFIG = {
    'symbol': 'NASDAQ',
    'start_year': 2020,
    'start_month': 1,
    'investment_period_years': 3,
    'dca_months': 24,
}
```

### 예시 2: 코스피 5년 투자 (60개월 분할)
```python
BACKTEST_CONFIG = {
    'symbol': 'KOSPI',
    'start_year': 2015,
    'start_month': 6,
    'investment_period_years': 5,
    'dca_months': 60,
}
```

### 예시 3: S&P 500 단기 투자 (12개월 분할)
```python
BACKTEST_CONFIG = {
    'symbol': 'SP500',
    'start_year': 2022,
    'start_month': 3,
    'investment_period_years': 1,
    'dca_months': 12,
}
```

## 결과물

백테스트 실행 후 생성되는 파일들:

### 1. Excel 분석 파일
**경로**: `results/excel/`
**파일명**: `lump_sum_vs_dca_{지수}_{시작년월}_{타임스탬프}.xlsx`

**포함 내용**:
- **매수 내역**: 거래별 세부 정보 (일시투자/적립투자)
- **일 수익률 변화**: 일별 포트폴리오 가치 변화
- **분석 요약**: 성과 지표 비교표

### 2. 백테스트 설정 시트
**위치**: Excel 파일의 "백테스트 설정" 시트

실행에 사용된 설정값들이 Excel 내에 저장되어 추후 재현 가능

### 3. 성과 지표

| 지표        | 설명                            |
| ----------- | ------------------------------- |
| 최종 수익률 | 투자 종료 시점 총 수익률        |
| CAGR        | 연평균 성장률                   |
| MDD         | 최대 손실폭 (Maximum Drawdown)  |
| 샤프 지수   | 위험 대비 수익률 (소수점 2자리) |
| 변동성      | 수익률의 표준편차               |
| 최종 가치   | 투자 종료 시점 포트폴리오 가치  |

## 장점

### 테스트 코드 방식의 장점
1. **반복 실행 용이**: 설정만 변경하고 즉시 재실행
2. **설정 관리 간편**: 변수 값만 수정
3. **자동화 가능**: 스크립트로 일괄 실행 가능
4. **버전 관리**: 설정 변경 사항 추적 가능
5. **배치 실행**: 여러 시나리오 연속 실행 가능

## 주의사항

1. **데이터 파일 확인**: 선택한 지수의 데이터 파일이 `data/` 폴더에 있는지 확인
2. **날짜 범위**: 투자 기간이 데이터 범위를 벗어나지 않도록 주의
3. **분할 월수**: DCA 분할 월수가 투자 기간을 초과하지 않도록 설정
4. **메모리 사용**: 긴 투자 기간일수록 더 많은 메모리 사용

## 트러블슈팅

### 자주 발생하는 오류

#### 1. 데이터 파일 없음
```
FileNotFoundError: [Errno 2] No such file or directory: 'data/SYMBOL_data.csv'
```
**해결**: 해당 지수의 데이터 파일이 `data/` 폴더에 있는지 확인

#### 2. 날짜 범위 초과
```
ValueError: 투자 기간이 데이터 범위를 벗어남
```
**해결**: 투자 시작일과 기간을 데이터 범위 내로 조정

#### 3. 분할 월수 오류
```
ValueError: DCA 분할 월수가 투자 기간을 초과함
```
**해결**: `dca_months` 값을 `investment_period_years * 12` 이하로 설정

## 확장 계획

향후 추가될 백테스트 유형들:

1. **모멘텀 투자 전략**
2. **변동성 돌파 전략**
3. **리밸런싱 전략**
4. **섹터별 투자 전략**

각 백테스트는 독립적인 디렉토리 구조를 가지며, 동일한 테스트 코드 방식을 사용할 예정입니다.

---

**작성일**: 2025-07-19  
**버전**: 1.0  
**대상**: 일시투자 vs 적립투자 백테스트