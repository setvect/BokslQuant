# 일시투자 vs 적립투자 백테스팅 사용설명서

## 개요
이 백테스팅 시스템은 동일한 투자 자금으로 **일시투자**와 **적립투자(DCA)** 전략의 성과를 비교 분석합니다.

## 백테스팅 방법

### 투자 전략 비교
- **일시투자**: 투자 시작일에 전체 자금을 한 번에 투자
- **적립투자**: 설정한 기간에 걸쳐 매월 동일한 금액으로 분할 투자

### 분석 방법론
1. **동일 조건**: 같은 투자 자금(10,000,000원), 같은 투자 기간으로 공정 비교
2. **성과 지표**: CAGR, MDD, 샤프 지수, 변동성으로 종합 평가
3. **시각화**: 4가지 인사이트 차트로 직관적 비교 분석

## 백테스팅 실행 방법

### 1. 롤링 백테스트 (여러 기간 일괄 분석)
```bash
cd src/lump_sum_vs_dca  
python run_rolling_batch.py
```

### 2. 개별 백테스트
```bash
cd src/lump_sum_vs_dca
python run_backtest.py
```

## 설정 변수 설명

### 롤링 백테스트 설정 (`run_rolling_batch.py`)
```python
BATCH_CONFIG = {
    'symbol': 'NASDAQ',                    # 투자 대상 지수
    'start_year': 1999,                    # 분석 시작 연도
    'end_year': 2001,                      # 분석 종료 연도
    'investment_period_years': 10,         # 각 테스트의 투자 기간
    'dca_months': 60,                      # 적립투자 분할 개월수
}
```

### 개별 백테스트 설정 (`run_backtest.py`)
```python
BACKTEST_CONFIG = {
    'symbol': 'NASDAQ',                    # 투자 대상 지수
    'start_year': 2000,                    # 투자 시작 연도
    'start_month': 1,                      # 투자 시작 월 (1-12)
    'investment_period_years': 10,         # 투자 기간 (년)
    'dca_months': 60,                      # 적립투자 분할 개월수
}
```

### 변수 상세 설명

| 변수명                    | 설명                 | 값 범위                                                        | 예시                 |
| ------------------------- | -------------------- | -------------------------------------------------------------- | -------------------- |
| `symbol`                  | 투자 대상 시장 지수  | NASDAQ, S&P500, KOSPI, KOSDAQ, DOW, FTSE, DAX, CAC, NIKKEI, HSI | 'NASDAQ'             |
| `start_year`              | 투자 시작 연도       | 1990~현재                                                      | 2020                 |
| `start_month`             | 투자 시작 월         | 1~12                                                           | 3 (3월)              |
| `investment_period_years` | 투자 기간 (년)       | 1~30                                                           | 5 (5년간 투자)       |
| `dca_months`              | 적립투자 분할 개월수 | 1~360                                                          | 24 (2년에 걸쳐 분할) |
| `end_year`                | 롤링 분석 종료 연도  | start_year 이후                                                | 2025                 |

### 투자 자금
- **고정값**: 10,000,000원 (1천만원)
- **일시투자**: 시작일에 전액 투자
- **적립투자**: `dca_months`로 나누어 매월 투자

## 결과 파일 출력

### 디렉토리 구조
```
results/lump_sum_vs_dca/
└── {symbol}_{start_year}_{start_month}/
    ├── excel/
    │   └── 일시투자vs적립투자_{symbol}_{start_date}.xlsx
    └── charts/
        ├── 누적수익률_비교.png
        ├── 포트폴리오_가치_변화.png
        ├── MDD_비교.png
        └── 투자타이밍_효과.png
```

### Excel 리포트 (4개 시트)

#### 1. "백테스트 설정" 시트
- 투자 설정 정보 (지수, 기간, 투자 자금)
- 실행 정보 (실행 시간, 분석 기간)
- 성과 요약 (CAGR, MDD, 샤프 지수)

#### 2. "매수 내역" 시트
- 각 전략별 매수 거래 내역
- 매수일, 주가, 수량, 누적 투자 금액
- 평균 매수 단가 계산

#### 3. "일 수익률 변화" 시트
- 일별 포트폴리오 가치 변화
- 투자 원금 대비 수익률
- MDD(최대낙폭) 추적

#### 4. "분석 요약" 시트
- 두 전략의 핵심 지표 비교
- 최종 수익률, 위험 지표
- 투자 효율성 분석

### 차트 시각화 (4가지)

#### 1. 누적수익률 비교
- 시간에 따른 누적수익률 변화
- 두 전략 간 수익률 차이 강조

#### 2. 포트폴리오 가치 변화  
- 투자 원금 vs 포트폴리오 가치
- 투자 자금 투입 과정 시각화

#### 3. MDD 비교
- 최대낙폭 구간 비교
- 위험 관리 관점에서의 전략 평가

#### 4. 투자타이밍 효과
- 적립투자의 시점별 기여도
- 시장 타이밍의 영향 분석

## 롤링 백테스트 추가 결과

### 롤링 차트 (3가지)
```
charts/
├── 롤링_수익률_타임라인.png      # 시작 시점별 성과 비교
├── 롤링_성과_히트맵.png          # 년-월별 성과 패턴
└── 롤링_요약_대시보드.png        # 통계 요약 시각화
```

### 롤링 Excel 리포트
- 각 시작 시점별 상세 분석 결과
- 기간별 성과 통계 요약
- 최적/최악 투자 시점 분석

## 분석 결과 해석 가이드

### 성과 지표 해석
- **CAGR**: 연평균 복합 성장률 (높을수록 좋음)
- **MDD**: 최대낙폭 (낮을수록 좋음, 음수로 표시)
- **샤프 지수**: 위험 대비 수익률 (높을수록 좋음)
- **변동성**: 수익률의 표준편차 (낮을수록 안정적)

### 전략별 특징
- **일시투자**: 시장 타이밍에 민감, 높은 수익률 가능성
- **적립투자**: 시장 변동성 완화, 안정적 수익률

### 의사결정 가이드
1. **수익률 중심**: CAGR이 높은 전략 선택
2. **안정성 중심**: MDD와 변동성이 낮은 전략 선택  
3. **효율성 중심**: 샤프 지수가 높은 전략 선택
4. **시장 상황**: 상승장에서는 일시투자, 변동성 장에서는 적립투자 유리

## 활용 팁

### 분석 시나리오
- **단기 vs 장기**: 투자 기간에 따른 전략 효과 비교
- **분할 기간 최적화**: `dca_months` 조정으로 최적 분할 기간 탐색
- **시장별 비교**: 다양한 지수에서의 전략 효과 분석
- **경제 사이클**: 다양한 시작 시점에서의 롤링 분석

### 주의사항
- 과거 데이터 기반 분석으로 미래 성과를 보장하지 않음
- 거래 수수료, 세금 등 실제 비용은 고려되지 않음
- 배당금 재투자는 포함되지 않음